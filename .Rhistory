states <- geojsonio::geojson_read("geojson/us-states.json", what = "sp")
runApp('server.R')
runApp('server.R')
library(tidyr)
library(dplyr, warn.conflicts = FALSE)
df <- tibble(
group = c(1:2, 1),
item_id = c(1:2, 2),
item_name = c("a", "b", "b"),
value1 = 1:3,
value2 = 4:6
)
df
df %>% complete(group, nesting(item_id, item_name))
# You can also choose to fill in missing values
df %>% complete(group, nesting(item_id, item_name), fill = list(value1 = 0))
df
df %>% complete(group, nesting(item_id))
df %>% complete(group, nesting(item_name))
dg = tibble (states)
dg = tibble (states$name)
View(dg)
dg = tibble (states$name, 0:0)
setdiff(df,dg)
df = c(1:5)
dg = c(3:6)
setdiff(df,dg)
setdiff(dg,df)
setdiff(df,dg)
setdiff(states$name,dg)
test = tibble(states = setdiff(states$name,dg))
View(test)
df = states$name[1:10]
setdiff(states$name,df)
difference = setdiff(states$name,df)
df = c(df,difference)
df = states$name[1:10]
rm(df)
rm(dg)
df = states$name[1:10]
df
df = states$name
df
view(df)
View(df)
df = states$name[1:10]
difference = setdiff(states$name,df)
df = c(df,difference)
df = states$name[1:10]
difference = setdiff(states$name,df)
View(difference)
rbind(df,difference)
test = rbind(df,difference)
View(test)
df = tibble(states$name[1:10])
View(df)
difference = tibble(setdiff(states$name,df))
difference = tibble(setdiff(states$name,df$`states$name[1:10]`))
test = rbind(df,difference)
df = tibble(states$name[1:10])
colnames(df) = "State"
difference = tibble(setdiff(states$name,df$`states$name[1:10]`))
colnames(difference) = "State"
df = tibble(states$name[1:10])
colnames(df) = "State"
difference = tibble(setdiff(states$name,df$State))
colnames(difference) = "State"
test = rbind(df,difference)
View(test)
View(STD)
View(STD)
runApp('server.R')
difference = tibble(
setdiff(states$name,df$State))
difference = tibble( Disease = 0,
setdiff(states$name,df$State))
difference = tibble( Disease = "",
setdiff(states$name,df$State))
difference = tibble( Disease = "",
Year = 0,
Race/Ethnicity ="",
Age = "",
Age_Code = "",
STD_Cases = 0,
Population = 0,
Gender = "",
Gender_Code = "",
Rate_Calc = 0)
difference = tibble( Disease = "",
Year = 0,
Race/Ethnicity ="",
Age = "",
Age_Code = "",
STD_Cases = 0,
Population = 0,
Gender = "",
Gender_Code = "",
Rate_Calc = 0)
difference = tibble( Disease = ""
Year = 0,
Race/Ethnicity ="",
Age = "",
Age_Code = "",
STD_Cases = 0,
Population = 0,
Gender = "",
Gender_Code = "",
Rate_Calc = 0)
difference = tibble( Disease = "",
Year = 0,
Race/Ethnicity ="",
Age = "",
Age_Code = "",
STD_Cases = 0,
Population = 0,
Gender = "",
Gender_Code = "",
Rate_Calc = 0)
difference = tibble( Disease = "",
Year = "0",
Race/Ethnicity ="",
Age = "",
Age_Code = "",
STD_Cases = 0,
Population = 0,
Gender = "",
Gender_Code = "",
Rate_Calc = 0)
difference = tibble( Disease = "",
Year = "0")
difference = tibble( Disease = "",
setdiff(states$name,df$State),
Year = "0")
difference = tibble( Disease = "",
setdiff(states$name,df$State),
Year = "0",
Race/Ethnicity ="",
Age = "")
difference = tibble( Disease = "",
setdiff(states$name,df$State),
Year = "0",
"Race/Ethnicity" ="",
Age = "")
difference = tibble( Disease = "",
setdiff(states$name,df$State),
Year = "0",
"Race/Ethnicity" ="",
Age = "",
Age_Code = "",
STD_Cases = 0,
Population = 0,
Gender = "",
Gender_Code = "",
Rate_Calc = 0)
df = tibble(c(states$name[1:10], states$name[21:30]))
colnames(df) = "State"
df = tibble(c(states$name[1:10], states$name[21:30]))
colnames(df) = "State"
difference = tibble( Disease = "",
setdiff(states$name,df$State),
Year = "0",
"Race/Ethnicity" ="",
Age = "",
Age_Code = "",
STD_Cases = 0,
Population = 0,
Gender = "",
Gender_Code = "",
Rate_Calc = 0)
setdiff(states$name,df$State)
colnames(difference) = c("Disease", "State", "Year", "Race/Ethnicity", "Age", "Age_Code", "STD_Cases", "Population", "Gender",
"Gender_Code", "Rate_Calc")
test = rbind(df,difference)
df = STD %>% filter(Disease == "Syphilis")
df = STD %>% filter(Disease == "Primary and Secondary Syphilis")
View(df)
df = STD %>% filter(Disease == "Primary and Secondary Syphilis") %>% filter(Year == "1996")
df = STD %>% filter(Disease == "Primary and Secondary Syphilis") %>% filter(Year == "1996") %>%
filter(Gender == "Male")
df = STD %>% filter(Disease == "Primary and Secondary Syphilis") %>% filter(Year == "1996") %>%
filter(Gender == "Male") %>% filter(Age_Code == "0-14")
View(df)
df %>% mutate(RateCalc='')
df = df %>% mutate(RateCalc='')
df = STD %>% filter(Disease == "Primary and Secondary Syphilis") %>% filter(Year == "1996") %>%
filter(Gender == "Male") %>% filter(Age_Code == "0-14")
df = df %>% mutate(RateCalc='')
difference = tibble( Disease = "",
setdiff(states$name,df$State),
Year = "0",
"Race/Ethnicity" ="",
Age = "",
Age_Code = "",
STD_Cases = 0,
Population = 0,
Gender = "",
Gender_Code = "",
Rate_Calc = 0)
colnames(difference) = c("Disease", "State", "Year", "Race/Ethnicity", "Age", "Age_Code", "STD_Cases", "Population", "Gender",
"Gender_Code", "Rate_Calc")
test = rbind(df,difference)
df = STD %>% filter(Disease == "Primary and Secondary Syphilis") %>% filter(Year == "1996") %>%
filter(Gender == "Male") %>% filter(Age_Code == "0-14")
df = df %>% mutate(Rate_Calc='')
difference = tibble( Disease = "",
setdiff(states$name,df$State),
Year = "0",
"Race/Ethnicity" ="",
Age = "",
Age_Code = "",
STD_Cases = 0,
Population = 0,
Gender = "",
Gender_Code = "",
Rate_Calc = 0)
colnames(difference) = c("Disease", "State", "Year", "Race/Ethnicity", "Age", "Age_Code", "STD_Cases", "Population", "Gender",
"Gender_Code", "Rate_Calc")
test = rbind(df,difference)
View(test)
View(states$name)
test$state = factor(test$State, levels = c(states$name))
test[order(test$State),]
test = test[order(test$State),]
test$state
test$State
levels(test$State)
levels(test$state)
test$State = factor(test$State, levels = c(states$name))
test = test[order(test$State),]
df = STD %>% filter(Disease == "Primary and Secondary Syphilis") %>% filter(Year == "1996") %>%
filter(Gender == "Male") %>% filter(Age_Code == "0-14")
df = df %>% mutate(Rate_Calc='')
difference = tibble( Disease = "",
setdiff(states$name,df$State),
Year = "0",
"Race/Ethnicity" ="",
Age = "",
Age_Code = "",
STD_Cases = 0,
Population = 0,
Gender = "",
Gender_Code = "",
Rate_Calc = 0)
setdiff(states$name,df$State)
colnames(difference) = c("Disease", "State", "Year", "Race/Ethnicity", "Age", "Age_Code", "STD_Cases", "Population", "Gender",
"Gender_Code", "Rate_Calc")
test = rbind(df,difference)
test$State = factor(test$State, levels = c(states$name))
test = test[order(test$State),]
df = STD %>% filter(Disease == "Primary and Secondary Syphilis") %>% filter(Year == "1996") %>%
filter(Gender == "Male") %>% filter(Age_Code == "0-14")
df = df %>% mutate(Rate_Calc='')
difference = tibble( Disease = "",
setdiff(states$name,df$State),
Year = "0",
"Race/Ethnicity" ="",
Age = "",
Age_Code = "",
STD_Cases = 0,
Population = 0,
Gender = "",
Gender_Code = "",
Rate_Calc = 0)
setdiff(states$name,df$State)
colnames(difference) = c("Disease", "State", "Year", "Race/Ethnicity", "Age", "Age_Code", "STD_Cases", "Population", "Gender",
"Gender_Code", "Rate_Calc")
test = rbind(df,difference)
test$State = factor(test$State, levels = c(states$name))
levels(test$State)
test = test[order(test$State),]
test = test[order(test$State),]
View(test)
test$state = factor(test$state, levels = c(states$name))
test = test[order(test$State),]
test$State = factor(test$State, levels = c(states$name))
test = test[order(test$State),]
test = rbind(df,difference)
test$state = factor(test$State, levels = c(states$name))
test = test[order(test$State),]
levels(test$state)
test = test[order(test$state),]
View(df)
View(test)
states$name
df = STD %>% filter(Disease == "Primary and Secondary Syphilis") %>% filter(Year == "1996") %>%
filter(Gender == "Male") %>% filter(Age_Code == "0-14")
df = df %>% mutate(Rate_Calc='')
difference = tibble( Disease = "",
setdiff(states$name,df$State),
Year = "0",
"Race/Ethnicity" ="",
Age = "",
Age_Code = "",
STD_Cases = 0,
Population = 0,
Gender = "",
Gender_Code = "",
Rate_Calc = 0)
setdiff(states$name,df$State)
colnames(difference) = c("Disease", "State", "Year", "Race/Ethnicity", "Age", "Age_Code", "STD_Cases", "Population", "Gender",
"Gender_Code", "Rate_Calc")
test = rbind(df,difference)
test = test[order(match(test$State, states$name)),]
runApp('server.R')
############
STD1 = STD
STD = STD1 %>% filter(Disease == "Primary and Secondary Syphilis") %>% filter(Year == "1996") %>%
filter(Gender == "Male") %>% filter(Age_Code == "0-14")
View(STD1)
View(STD)
STD1 = STD1 %>% filter(Disease == "Primary and Secondary Syphilis") %>% filter(Year == "1996") %>%
filter(Gender == "Male") %>% filter(Age_Code == "0-14")
# Creating two new DT : one to summarise the cases and one to summarise the population
STD1Cases = STD1 %>% group_by(State) %>% summarise(STD_Cases = sum(STD_Cases))
STD1Pop = STD1 %>% group_by(State) %>% summarise (Population = sum(Population))
#Setting the old work as the new base for the cases
STD1 = STD1Cases
rm(STD1Cases)
#Creating the rates in the working table
STD1 = STD1 %>% mutate (RateCalc = STD1$STD_Cases * 1000 / STD1Pop$Population)
View(STD1)
View(STD1Pop)
STD1=tibble(STD1, STD1Pop$Population)
STD1=left_join(STD1, STD1Pop$Population)
STD1 = STD1 %>% mutate(Population = STD1Pop$Population)
runApp('server.R')
runApp('server.R')
dim(STD1)
dim(difference)
View(difference)
difference = tibble(setdiff(states$name,STD1$State),
STD_Cases = 0,
RateCalc = 0,
Population = 0,
)
View(difference)
dim(difference)
rm(STD1, STD1Pop)
rm(difference)
rm-df
rm(df)
rm(test)
rm(STD)
library (readr)
library (dplyr)
#Creating the inputs
states <- geojsonio::geojson_read("geojson/us-states.json", what = "sp")
varsDisease = c(
"Chlamydia" = "Chlamydia",
"Gonorrhea" = "Gonorrhea",
"Primary and Secondary Syphilis" = "Primary and Secondary Syphilis",
"All" = "All"
)
varsGender = c(
"Male" = "Male",
"Female" = "Female",
"All" = "All"
)
varsAge = c(
"0-14 years" = "0-14",
"15-19 years" = "15-19",
"20-24 years" = "20-24",
"25-29 years" = "25-29",
"30-34 years" = "30-34",
"35-39 years" = "35-39",
"More than 40 years" = "40+",
"All" = "All"
)
varsEthnia = c(
"American Indian or Alaska Native" = "American Indian or Alaska Native",
"Asian or Pacific Islander" = "Asian or Pacific Islander",
"Black or African American" = "Black or African American",
"Hispanic" = "Hispanic" ,
"White" = "White"
)
#Importing STD data
ChlamydiaF <- read_delim("data/ChlamydiaF.txt",
"\t", escape_double = FALSE, col_types = cols(Age = col_character(),
`Age Code` = col_character(), Disease = col_character(),
`Disease Code` = col_skip(), Notes = col_skip(),
Population = col_integer(), `Race/Ethnicity` = col_character(),
`Race/Ethnicity Code` = col_skip(),
Rate = col_skip(), `STD Cases` = col_integer(),
State = col_character(), `State Code` = col_skip(),
Year = col_integer(), `Year Code` = col_skip()),
trim_ws = TRUE)
ChlamydiaF = ChlamydiaF %>% mutate(Gender = "Female", Gender_Code = "F")
ChlamydiaM <- read_delim("data/ChlamydiaM.txt",
"\t", escape_double = FALSE, col_types = cols(Age = col_character(),
`Age Code` = col_character(), Disease = col_character(),
`Disease Code` = col_skip(), Notes = col_skip(),
Population = col_integer(), `Race/Ethnicity` = col_character(),
`Race/Ethnicity Code` = col_skip(),
Rate = col_skip(), `STD Cases` = col_integer(),
State = col_character(), `State Code` = col_skip(),
Year = col_integer(), `Year Code` = col_skip()),
trim_ws = TRUE)
ChlamydiaM = ChlamydiaM %>% mutate(Gender = "Male", Gender_Code = "M")
ChlamydiaU <- read_delim("data/ChlamydiaU.txt",
"\t", escape_double = FALSE, col_types = cols(Age = col_character(),
`Age Code` = col_character(), Disease = col_character(),
`Disease Code` = col_skip(), Notes = col_skip(),
Population = col_integer(), `Race/Ethnicity` = col_character(),
`Race/Ethnicity Code` = col_skip(),
Rate = col_skip(), `STD Cases` = col_integer(),
State = col_character(), `State Code` = col_skip(),
Year = col_integer(), `Year Code` = col_skip()),
trim_ws = TRUE)
ChlamydiaU = ChlamydiaU %>% mutate(Gender = "Unknown", Gender_Code = "U")
GonorrheaF <- read_delim("data/GonorrheaF.txt",
"\t", escape_double = FALSE, col_types = cols(Age = col_character(),
`Age Code` = col_character(), Disease = col_character(),
`Disease Code` = col_skip(), Notes = col_skip(),
Population = col_integer(), `Race/Ethnicity` = col_character(),
`Race/Ethnicity Code` = col_skip(),
Rate = col_skip(), `STD Cases` = col_integer(),
State = col_character(), `State Code` = col_skip(),
Year = col_integer(), `Year Code` = col_skip()),
trim_ws = TRUE)
GonorrheaF = GonorrheaF %>% mutate(Gender = "Female", Gender_Code = "F")
GonorrheaM <- read_delim("data/GonorrheaM.txt",
"\t", escape_double = FALSE, col_types = cols(Age = col_character(),
`Age Code` = col_character(), Disease = col_character(),
`Disease Code` = col_skip(), Notes = col_skip(),
Population = col_integer(), `Race/Ethnicity` = col_character(),
`Race/Ethnicity Code` = col_skip(),
Rate = col_skip(), `STD Cases` = col_integer(),
State = col_character(), `State Code` = col_skip(),
Year = col_integer(), `Year Code` = col_skip()),
trim_ws = TRUE)
GonorrheaM = GonorrheaM %>% mutate(Gender = "Male", Gender_Code = "M")
GonorrheaU <- read_delim("data/GonorrheaU.txt",
"\t", escape_double = FALSE, col_types = cols(Age = col_character(),
`Age Code` = col_character(), Disease = col_character(),
`Disease Code` = col_skip(), Notes = col_skip(),
Population = col_integer(), `Race/Ethnicity` = col_character(),
`Race/Ethnicity Code` = col_skip(),
Rate = col_skip(), `STD Cases` = col_integer(),
State = col_character(), `State Code` = col_skip(),
Year = col_integer(), `Year Code` = col_skip()),
trim_ws = TRUE)
GonorrheaU = GonorrheaU %>% mutate(Gender = "Unknown", Gender_Code = "U")
SyphilisF <- read_delim("data/SyphilisF.txt",
"\t", escape_double = FALSE, col_types = cols(Age = col_character(),
`Age Code` = col_character(), Disease = col_character(),
`Disease Code` = col_skip(), Notes = col_skip(),
Population = col_integer(), `Race/Ethnicity` = col_character(),
`Race/Ethnicity Code` = col_skip(),
Rate = col_skip(), `STD Cases` = col_integer(),
State = col_character(), `State Code` = col_skip(),
Year = col_integer(), `Year Code` = col_skip()),
trim_ws = TRUE)
SyphilisF = SyphilisF %>% mutate(Gender = "Female", Gender_Code = "F")
SyphilisM <- read_delim("data/SyphilisM.txt",
"\t", escape_double = FALSE, col_types = cols(Age = col_character(),
`Age Code` = col_character(), Disease = col_character(),
`Disease Code` = col_skip(), Notes = col_skip(),
Population = col_integer(), `Race/Ethnicity` = col_character(),
`Race/Ethnicity Code` = col_skip(),
Rate = col_skip(), `STD Cases` = col_integer(),
State = col_character(), `State Code` = col_skip(),
Year = col_integer(), `Year Code` = col_skip()),
trim_ws = TRUE)
SyphilisM = SyphilisM %>% mutate(Gender = "Male", Gender_Code = "M")
SyphilisU <- read_delim("data/SyphilisU.txt",
"\t", escape_double = FALSE, col_types = cols(Age = col_character(),
`Age Code` = col_character(), Disease = col_character(),
`Disease Code` = col_skip(), Notes = col_skip(),
Population = col_integer(), `Race/Ethnicity` = col_character(),
`Race/Ethnicity Code` = col_skip(),
Rate = col_skip(), `STD Cases` = col_integer(),
State = col_character(), `State Code` = col_skip(),
Year = col_integer(), `Year Code` = col_skip()),
trim_ws = TRUE)
SyphilisU = SyphilisU %>% mutate(Gender = "Unknown",Gender_Code = "U")
#Combining all the data in one DT for the map
STD = bind_rows (ChlamydiaF, ChlamydiaM, ChlamydiaU, GonorrheaF, GonorrheaM, GonorrheaU, SyphilisF, SyphilisM, SyphilisU)
rm (ChlamydiaF, ChlamydiaM, ChlamydiaU, GonorrheaF, GonorrheaM, GonorrheaU, SyphilisF, SyphilisM, SyphilisU) #Closing the old tables
colnames (STD) = c("Disease", "State", "Year", "Race/Ethnicity", "Age", "Age_Code", "STD_Cases", "Population", "Gender", "Gender_Code")
#Janitoring the data
temp = which (is.na(STD$"Population"))
if (length(temp) != 0) #Vérifiyng that the vector isn't empty
{STD = STD[-c(temp),]}
write.csv(STD, "data/STD.csv")
saveRDS(STD, "data/STD.rds")
STD1 = STD
STD1 = STD1 %>% filter(Disease == "Primary and Secondary Syphilis") %>% filter(Year == "1996") %>%
filter(Gender == "Male") %>% filter(Age_Code == "0-14")
# Creating two new DT : one to summarise the cases and one to summarise the population
STD1Cases = STD1 %>% group_by(State) %>% summarise(STD_Cases = sum(STD_Cases))
STD1Pop = STD1 %>% group_by(State) %>% summarise (Population = sum(Population))
#Setting the old work as the new base for the cases
STD1 = STD1Cases
rm(STD1Cases)
#Creating the rates in the working table
STD1 = STD1 %>% mutate (RateCalc = STD1$STD_Cases * 1000 / STD1Pop$Population)
STD1 = STD1 %>% mutate(Population = STD1Pop$Population)
difference = tibble(setdiff(states$name,STD1$State),
STD_Cases = 0,
RateCalc = 0,
Population = 0,
)
View(difference)
colnames(difference) = c("State","STD_Cases", "RateCalc" , "Population")
DefinitiveSTD1 = rbind(STD1,difference)
View(DefinitiveSTD1)
DefinitiveSTD1 = DefinitiveSTD1[order(match(DefinitiveSTD1$State, states$name)),]
runApp('server.R')
runApp('server.R')
runApp('server.R')
rm(DefinitiveSTD1, difference, STD1, STD1Pop)
runApp('server.R')
